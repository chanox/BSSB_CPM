
<div class="small-header">
    <div class="hpanel">
        <div class="panel-body">
            @*<div id="hbreadcrumb" class="pull-right">
                    <ol class="hbreadcrumb breadcrumb">
                        <li><a href="#">@ViewBag.Header</a></li>
                        <li class="active">
                            <span>@ViewBag.Title </span>
                        </li>
                    </ol>
                </div>*@
            <h2 class="font-light m-b-xs">
                @ViewBag.Header
            </h2>
            <small>@ViewBag.Keterangan</small>
        </div>
    </div>
</div>

<div class="content transition animated fadeInUp">
    @* - MODAL USER - *@
    <div class="modal fade" id="mdlCreateUser" role="dialog" aria-hidden="true" style="display: none;" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="color-line"></div>
                <div class="modal-header">
                    <h4 class="modal-title">User Baru</h4>
                    <small><i class="fa fa-quote-right"></i> Pembuatan & perubahan data user / pengguna</small>
                </div>

                <div class="modal-body" id="dvCreateUser">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-style="zoom-in" id="bSimpanUser"><i class="fa fa-check"></i> Simpan &amp; Proses</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i>  Batal</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="mdlEditUser" role="dialog" aria-hidden="true" style="display: none;" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="color-line"></div>
                <div class="modal-header">
                    <h4 class="modal-title">Ubah Data</h4>
                    <small><i class="fa fa-quote-right"></i> Perubahan data user / pengguna</small>
                </div>

                <div class="modal-body" id="dvEditUser">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-style="zoom-in" id="bEditUser"><i class="fa fa-pencil"></i>  Ubah Data</button>
                    <button type="button" class="btn btn-info" data-style="zoom-in" id="bResetPassword"><i class="fa fa-key"></i> Reset Password</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Batal</button>
                </div>
            </div>
        </div>
    </div>

    @*<div class="row">
            <div class="col-lg-12">
                <div class="hpanel">
                    <div class="panel-body">
                        <h3>Forms extended</h3>
                        <p>Extra from controls for select, date, multiselect, inline edit and spin. All form controls automatically receive some global styling.</p>
                    </div>
                </div>
            </div>
        </div>*@

    @*- MAIN MENU -*@
    <div class="row">
        <div class="col-lg-12">
            <!--<div class="hpanel">-->
                @*<div class="panel-heading">
                Daftar User
            </div>*@
                <!--<div class="panel-body">
                    <div class="pull-right text-right">
                        <button class="btn btn-primary" type="button" id="bTambahUser" data-toggle="tooltip" data-placement="top" title="Buat User Baru"><i class="fa fa-user-plus"></i></button>
                    </div>

                    <h3 class="m-b-xs">
                        DAFTAR USER
                    </h3>
                    <p>Informasi kode & nama user / pengguna yang terdaftar.</p>

                    <div class="hr-line-dashed"></div>

                    <div class="table-responsive">
                        <table id="dtDaftarUser" class="table table-striped table-bordered table-hover" cellpadding="0" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="text-center" hidden>Id</th>
                                    <th class="text-center">No</th>
                                    <th class="text-center">Username</th>
                                    <th class="text-center">Nama Lengkap</th>
                                    <th class="text-center">Jenis User</th>
                                    <th class="text-center">Unit Kerja</th>
                                    <th class="text-center">Aktif</th>
                                    <th class="text-center">Opsi</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>-->

            <div class="hpanel hgreen">
                @*<div class="panel-heading hbuilt">
                    <div class="panel-tools">
                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                        <a class="closebox"><i class="fa fa-times"></i></a>
                    </div>
                    Panel with alert
                </div>*@
                @*<div class="panel-heading" style="height:50px">
                    <div class="pull-right">
                        <a class="btn btn-primary btn-sm" id="bTambahUser" data-toggle="tooltip" data-placement="top" title="Buat User Baru"><i class="fa fa-user-plus"></i> Buat User Baru</a>
                    </div>
                    
                </div>*@
                @*style="background: #f7f9fa;"*@
                @*<div class="alert">
                    <div class="pull-right">
                        <a class="btn btn-primary" id="bTambahUser" data-toggle="tooltip" data-placement="top" title="Buat User Baru"><i class="fa fa-user-plus"></i></a>
                    </div>
                    <h4 class="m-b-xs">DAFTAR USER</h4>
                    <small><i class="fa fa-quote-right"></i> Informasi kode & nama user / pengguna yang terdaftar</small>
                </div>*@
                <div class="panel-heading">
                    <div class="pull-right">
                        <a class="btn btn-primary" id="bTambahUser" data-toggle="tooltip" data-placement="top" title="Buat User Baru"><i class="fa fa-user-plus"></i></a>
                    </div>
                    <h3 class="m-b-xs">DAFTAR USER</h3>
                    <small>Informasi kode & nama user / pengguna yang terdaftar</small>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table id="dtDaftarUser" class="table table-striped table-bordered table-hover" cellpadding="0" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="text-center" hidden>Id</th>
                                    <th class="text-center">No</th>
                                    <th class="text-center">Username</th>
                                    <th class="text-center">Nama Lengkap</th>
                                    <th class="text-center">Jenis User</th>
                                    <th class="text-center">Grup</th>
                                    <th class="text-center">Unit Kerja</th>
                                    <th class="text-center">Aktif</th>
                                    <th class="text-center">Opsi</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <environment names="Staging,Production,Development">
        <!-- Ladda -->
        @* <link rel="stylesheet" href="~/lib/ladda/dist/ladda-themeless.min.css" /> *@
        @* *@
        @* <link rel="stylesheet" href="~/lib/sweetalert2/dist/sweetalert2.css" /> *@
        @* $1$<link rel="stylesheet" href="~/lib/sweetalert/lib/sweetalert.css" />#1# *@
        @* <link rel="stylesheet" href="~/lib/toastr/lib/toastr.min.css" /> *@
        <link rel="stylesheet" href="~/lib/datatables.net-bs/css/dataTables.bootstrap.min.css" />

        <link rel="stylesheet" href="~/lib/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" />

        <link rel="stylesheet" href="~/lib/select2/select2.css" />
        <link rel="stylesheet" href="~/lib/select2-bootstrap/select2-bootstrap.css" />
    </environment>
}

@section Scripts {
    <environment names="Staging,Production,Development">
        @* <!-- Ladda --> *@
        @* <script src="~/lib/ladda/dist/spin.min.js"></script> *@
        @* <script src="~/lib/ladda/dist/ladda.min.js"></script> *@
        @* <script src="~/lib/ladda/dist/ladda.jquery.min.js"></script> *@
        @* *@
        @* <!-- TabAsEnter --> *@
        @* <script src="~/lib_addon/JoelPurra/emulatetab.joelpurra.js"></script> *@
        @* <script src="~/lib_addon/JoelPurra/plusastab.joelpurra.js"></script> *@
        @* *@
        @* <script src="~/lib/sweetalert2/dist/sweetalert2.js"></script> *@
        @* $1$<script src="~/lib/sweetalert/lib/sweetalert.min.js"></script>#1# *@
        @* <script src="~/lib/toastr/lib/toastr.min.js"></script> *@

        <script src="~/lib/bootbox/bootbox.js"></script>
        <script src="~/lib/datatables/media/js/jquery.dataTables.min.js"></script>
        <script src="~/lib/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="~/lib/pdfmake/build/pdfmake.min.js"></script>
        <script src="~/lib/pdfmake/build/vfs_fonts.js"></script>
        <script src="~/lib/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="~/lib/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="~/lib/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="~/lib/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>

        <script src="~/lib/select2/select2.min.js"></script>
        <script src="~/lib/moment/moment.js"></script>
    </environment>

    <script type="text/javascript">
        $(document).ready(function () {
            GetListUser();
            ProfilePiture();
        });

        // -- TAB AS ENTER
        JoelPurra.PlusAsTab.setOptions({
            // Use enter instead of plus
            // Number 13 found through demo at
            // http://api.jquery.com/event.which/
            key: 13
        });
        // -- END TAB AS ENTER

        // -- LOCK
        history.pushState(null, null, document.URL);
        window.addEventListener('popstate', function () {
            history.pushState(null, null, document.URL);
        });
        // -- END LOCK

        // -- AUTOCOMPLETE OFF
        $(document).on('focus', ':input', function () {
            $(this).attr('autocomplete', 'off');
        });
        // -- END AUTOCOMPLETE OFF

        // -- COMMAND ACTION
        function ReloadUserList() {
            $('#dtDaftarUser').DataTable().ajax.reload(null, false);
        }
        // -- END COMMAND ACTION

        // -- MODAL MENU
        $('#mdlCreateUser').on('shown.bs.modal', function () {
            $('#USER_NAME').focus();
        });

        $('#mdlCreateUser').on('hidden.bs.modal', function () {
            $('#dvCreateUser').html('');
        });

        $('#mdlEditUser').on('shown.bs.modal', function () {
            $('#NAMA_LENGKAP').focus();
        });

        $('#mdlEditUser').on('hidden.bs.modal', function () {
            $('#dvEditUser').html('');
        });
        // -- END MODAL MENU

        // -- USER COMMAND

        function GetListUser() {
            $('#dtDaftarUser').DataTable().destroy();
            $('#dtDaftarUser').DataTable({
                ajax: {
                    url: '@Url.Action("GetListUser", "User")',
                    dataSrc: ''
                },
                columns: [
                    { data: 'ID_USER', className: 'id hidden', render: function (data, type, row) { return data } },
                    { data: null, className: 'text-center', width: '5%', render: function (data, type, row, meta) { return meta.row + 1; } },
                    { data: 'USER_NAME', className: 'text-center', width: '20%', render: function (data, type, row) { return data } },
                    { data: 'NAMA_LENGKAP', width: '25%' },
                    { data: 'JENIS_USER', className: 'text-center', width: '10%' },
                    { data: 'GRUP_USER', className: 'text-center', width: '10%' },
                    { data: 'NM_UNITKER', className: 'text-center', width: '15%' },
                    {
                        data: "AKTIF",
                        render: function (data, type, row, meta) {
                            if (data == true) {
                                return '<div class="checkbox checkbox-success checkbox-circle"><input id="' + meta.row + '" type="checkbox" class="checkbox checkbox-success checkbox-circle" checked="" disabled><label for="' + meta.row + '"></label></div>';
                            }
                            else {
                                return '<div class="checkbox checkbox-sucess checkbox-circle"><input id="' + meta.row + '" type="checkbox" class="checkbox checkbox-success checkbox-circle" disabled><label for="' + meta.row + '"></label></div>';
                            }
                        },
                        className: 'text-center',
                        //width: '5%'
                    },
                    {
                        data: null,
                        className: 'text-center',
                        //width: '20%',
                        defaultContent: '<button type="button" class="btn btn-xs btn-primary btn-outline btn-edit" data-toggle="tooltip" data-placement="top" title="Ubah"><i class="fa fa-pencil"></i></button> <button type="button" class="btn btn-xs btn-danger btn-outline btn-delete" data-toggle="tooltip" data-placement="top" title="Hapus"><i class="fa fa-remove"></i></button>'
                    }
                ],
                autoWidth: false,
                oLanguage: { sSearch: 'Cari:' },
                drawCallback: function (settings) {
                    //if (!$('#dtDaftarUser').parent().hasClass("table-responsive")) {
                    //    $('#dtDaftarUser').wrap("<div class='table-responsive'></div>");
                    //}

                    $('[data-toggle="tooltip"]').tooltip();
                }
            });
        }

        function GetCreateUser() {
            $.get('@Url.Action("CreateUser", "User")', null, function (result) {
                $('#dvCreateUser').html(result);
                $.validator.unobtrusive.parse("#dvCreateUser");

                $('.select2-kantor').select2({
                    width: '100%'
                });
                $('.select2-jenis').select2();

                $('#mdlCreateUser').modal('show');
            });
        }

        function GetEditUser(id) {
            $.get('@Url.Action("EditUser", "User")', { ID_USER: id }, function (result) {
                $('#dvEditUser').html(result);
                $.validator.unobtrusive.parse("#dvEditUser");

                $('.select2-kantor').select2();
                $('.select2-jenis').select2();

                $('#mdlEditUser').modal('show');
            });
        }

        function PostCreateUser() {
            if ($('#form-create').valid()) {
                $.post('@Url.Action("CreateUser", "User")', $('#form-create').serializeArray(), function (result) {

                    if (result === '0') {
                        $('#mdlTanya').modal('hide');
                        swal.fire('Informasi', 'Data user / pengguna berhasil di simpan.', 'success')
                            .then(() => { ReloadUserList(); });
                    }
                    else {
                        alert(result);
                        return;
                    }

                    $('#dtDaftarUser').DataTable().ajax.reload(null, false);
                    $('#mdlCreateUser').modal('hide');
                });
            }
            else {
                swal.close();
                $('#USER_NAME').focus();
            }
        }

        function PostEditUser() {
            if ($('#form-edit').valid()) {
                $.post('@Url.Action("EditUser", "User")', $('#form-edit').serializeArray(), function (result) {

                    if (result === '0') {
                        swal.fire('Informasi', 'Data user / pengguna berhasil di simpan.', 'success')
                            .then(() => { ReloadUserList(); });
                    }
                    else {
                        return;
                    }

                    $('#dtDaftarUser').DataTable().ajax.reload(null, false);
                    $('#mdlEditUser').modal('hide');
                });
            }
            else {
                swal.close();
                $('#USER_NAME').focus();
            }
        }

        function PostDeleteUser(id) {
            $.post('@Url.Action("DeleteUser", "User")', { ID_USER: id }, function (result) {

                if (result === "0") {
                    $('#mdlTanya').modal('hide');
                    swal.fire('Informasi', 'Data user / pengguna berhasil di hapus.', 'success')
                        .then(() => { ReloadUserList(); });
                }
                else {
                    return;
                }

                $('#dtDaftarUser').DataTable().ajax.reload(null, false);
            });
        }

        $('#bTambahUser').click(function () {
            GetCreateUser();
        });

        $('#bSimpanUser').click(function () {
            swal.fire({
                title: 'Konfirmasi',
                text: 'Data yang akan di simpan sudah benar?',
                type: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya, Proses',
                cancelButtonText: 'Tidak',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                //reverseButtons: true,
                showLoaderOnConfirm: true,
                preConfirm: () => {
                    return new Promise(function () {
                        PostCreateUser();
                    });
                },
                allowOutsideClick: () => !swal.isLoading()
            });
        });

        $('#bEditUser').click(function () {
            swal.fire({
                title: 'Konfirmasi',
                text: 'Data yang akan di ubah sudah benar?',
                type: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya, Proses',
                cancelButtonText: 'Tidak',
                //confirmButtonColor: '#3085d6',
                //cancelButtonColor: '#d33',
                //reverseButtons: true,
                showLoaderOnConfirm: true,
                preConfirm: () => {
                    return new Promise(function () {
                        PostEditUser();
                    });
                },
                allowOutsideClick: () => !swal.isLoading()
            });
        });

        $('#dtDaftarUser').on('click', 'button.btn-edit', function (e) {
            var id = $(this).closest("tr").find(".id").text();
            GetEditUser(id);
        });

        $('#dtDaftarUser').on('click', 'button.btn-delete', function (e) {
            var id = $(this).closest("tr").find(".id").text();
            swal.fire({
                title: 'Konfirmasi',
                text: 'Data yang akan di hapus sudah benar?',
                type: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya, Proses',
                cancelButtonText: 'Tidak',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                //reverseButtons: true,
                showLoaderOnConfirm: true,
                //customClass: {
                //    confirmButton: 'btn btn-primary !important;',
                //    cancelButton: 'btn btn-danger !important;',
                //},
                preConfirm: () => {
                    return new Promise(function () {
                        PostDeleteUser(id);
                    });
                },
                allowOutsideClick: () => !swal.isLoading()
            });
        });

        $('#bResetPassword').click(function () {
            GetResetPasswordUser($('#ID_USER').val());
        });

        function GetResetPasswordUser(ID_USER) {
            $.post('@Url.Action("ResetPasswordUser", "User")', { ID_USER: ID_USER }, function (result) {

            if (result === '0') {
                swal.fire('Informasi', 'Password berhasil direset.', 'success')
                    .then(() => { ReloadUserList(); });
             }
             else {
                 return;
             }

                $('#dtDaftarUser').DataTable().ajax.reload(null, false);
                $('#mdlEditUser').modal('hide');
             });
        }
        // -- END USER COMMAND
    </script>

}

