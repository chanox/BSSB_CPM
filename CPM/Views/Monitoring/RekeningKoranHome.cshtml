<div class="small-header">
    <div class="hpanel">
        <div class="panel-body">
            <div id="hbreadcrumb" class="pull-right">
                    <ol class="hbreadcrumb breadcrumb">
                        <li><a href="#">@ViewBag.Header</a></li>
                        <li class="active">
                            <span>@ViewBag.Title </span>
                        </li>
                    </ol>
                </div>
            <h2 class="font-light m-b-xs">
                @ViewBag.Header
            </h2>
            <small>@ViewBag.Keterangan</small>
        </div>
    </div>
</div>

<div class="content transition animated fadeIn">
    <div class="row">
        <div class="col-lg-8">
            <div class="hpanel">
                <div class="panel-heading hbuilt">
                    @* <h3 class="m-b-xs">FILTER</h3> *@
                    <i class="fa fa-quote-right"></i> Menampilkan data sesuai pilihan tanggal & nomor rekening
                </div>
                
                <div class="panel-body">
                    @* <p><i class="fa fa-quote-right"></i> Menampilkan data sesuai pilihan tanggal & cabang</p> *@
                    @* <br/> *@
                    <div class="row">
                        <form class="form-horizontal">
                            <div class="col-md-12">
                                <div class="col-md-7">
                                    <div class="form-group">
                                        @* <label class="control-label col-md-2">Tanggal</label> *@
                                        @* <div class="input-group date"> *@
                                        @*     <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span> *@
                                        @*     <input type="text" id="tglData" class="form-control"> *@
                                        @* </div> *@
                                        <div class="input-daterange input-group col-md-11">
                                            <span class="input-group-addon">&nbsp;Tanggal&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                            <input type="text" class="form-control" name="start" id="tglAwal">
                                            <span class="input-group-addon">s.d</span>
                                            <input type="text" class="form-control" name="end" id="tglAkhir">
                                            <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-group col-md-5">
                                    <span class="input-group-addon">No. Rekening&nbsp;&nbsp;</span>
                                    <input type="text" id="noRek" class="form-control">
                                    <span class="input-group-btn">
                                        <button type="button" id="bSearch" class="ladda-button ldSearch btn btn-primary btn-outline" data-style="zoom-in">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </span>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-12">
            <div class="hpanel">
    
                <div class="panel-heading">
                    @* <div class="pull-right"> *@
                    @*     <a class="btn btn-warning" id="bTambahUser" data-toggle="tooltip" data-placement="top" title="Tamplikan Lengkap" href="@Url.Action("DaftarInHouse", "BPDP")"><i class="fa fa-th-list"></i></a> *@
                    @* </div> *@
                    <h3 class="m-b-xs">REKENING KORAN</h3>
                    <i class="fa fa-quote-right"></i> Menampilkan transaksi rekening koran
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table id="dtRekeningKoran" class="table table-striped table-bordered table-hover" cellpadding="0" style="width:100%">
                            <thead>
                            <tr>
                                <th class="text-center">No.</th>
                                <th class="text-center">Tanggal</th>
                                <th class="text-center">No. Dok</th>
                                <th class="text-center">Keterangan</th>
                                <th class="text-center">Debet</th>
                                <th class="text-center">Kredit</th>
                                <th class="text-center">Saldo</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

@section Styles {
    <environment names="Staging,Production,Development">
        <link rel="stylesheet" href="~/lib/toastr/lib/toastr.min.css" />
        <link rel="stylesheet" href="~/lib/datatables/media/css/dataTables.bootstrap.min.css" />
        <link rel="stylesheet" href="~/lib/datatables/media/css/responsive.dataTables.min.css" />
        <link rel="stylesheet" href="~/lib/datatables.net-bs/css/dataTables.bootstrap.min.css" />
        <link rel="stylesheet" href="~/lib/select2/select2.css" />
        <link rel="stylesheet" href="~/lib/select2-bootstrap/select2-bootstrap.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css" />
        <link rel="stylesheet" href="~/lib/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
        <link rel="stylesheet" href="~/lib/clockpicker/dist/bootstrap-clockpicker.min.css" />
        <link rel="stylesheet" href="~/lib/ladda/css/ladda-themed.scss"/>
    </environment>
}

@section Scripts {
    <environment names="Development,Staging,Production">
        <script src="~/lib/datatables/media/js/jquery.dataTables.min.js"></script>
        <script src="~/lib/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="~/lib/datatables/media/js/dataTables.responsive.min.js"></script>
        <script src="~/lib/datatables/media/js/dataTables.fixedColumns.min.js"></script>
        <script src="~/lib/pdfmake/build/pdfmake.min.js"></script>
        <script src="~/lib/pdfmake/build/vfs_fonts.js"></script>
        <script src="~/lib/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="~/lib/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="~/lib/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="~/lib/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="~/lib/select2/select2.min.js"></script>
        <script src="~/lib/moment/moment.js"></script>
        <script src="~/lib/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
        <script src="~/lib/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
        <script src="~/lib/clockpicker/dist/bootstrap-clockpicker.min.js"></script>
        <script src="~/lib/ladda/js/ladda.js"></script>
        <script src="~/lib/ladda/js/ladda.jquery.js"></script>
    </environment>
    
    <script type="text/javascript">

        $(document).ready(function () {
            $(document).idleTimer(300000);

            ProfilePiture();
            
            //$('#tglAwal').val('@DateTime.Now.AddDays(-2).ToString("yyyy-MM-dd")');
            $('#tglAwal').val('@ViewBag.FIRST_DATE');
            $('#tglAwal').datepicker({ format: 'yyyy-mm-dd' });

            $('#tglAkhir').val('@DateTime.Now.ToString("yyyy-MM-dd")');
            $('#tglAkhir').datepicker({ format: 'yyyy-mm-dd' });
            
            GetRekeningKoran();
        });

        // Idle Time
        $(document).on("idle.idleTimer", function (event, elem, obj) {
            window.location = '@Url.Action("Login", "User")';
        });

        function sleep(milliseconds) {
            var start = new Date().getTime();
            for (var i = 0; i < 1e7; i++) {
                if ((new Date().getTime() - start) > milliseconds) {
                    break;
                }
            }
        }

        //setInterval(function () { ReloadDaftar(); }, 25000);

        function formatMoney(amount, decimalCount = 2, decimal = ",", thousands = ".") {
            try {
                decimalCount = Math.abs(decimalCount);
                decimalCount = isNaN(decimalCount) ? 2 : decimalCount;

                const negativeSign = amount < 0 ? "-" : "";

                let i = parseInt(amount = Math.abs(Number(amount) || 0).toFixed(decimalCount)).toString();
                let j = (i.length > 3) ? i.length % 3 : 0;

                return negativeSign +
                    (j ? i.substr(0, j) + thousands : '') +
                    i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousands) +
                    (decimalCount ? decimal + Math.abs(amount - i).toFixed(decimalCount).slice(2) : "");
            } catch (e) {
                console.log(e)
            }
        }

        function GetRekeningKoran() {
            var l = $('.ldSearch').ladda();

            l.ladda('start');
            $('#dtRekeningKoran').DataTable().destroy();
            $('#dtRekeningKoran').DataTable({
                ajax: {
                    url: '@Url.Action("getRekeningKoran", "Monitoring")',
                    type: "GET",
                    data: { tglAwal: $('#tglAwal').val(), tglAkhir: $('#tglAkhir').val(), noRek: $('#noRek').val() },
                    dataSrc: function (json) {
                        if (JSON.stringify(json.HISTORY_TRANS) == 'null') {
                            json.HISTORY_TRANS = [];
                        }

                        l.ladda('stop');
                        return json.HISTORY_TRANS;
                    }
                },
                columns: [
                    { data: null, className: 'text-center', width: '5%', render: function (data, type, row, meta) { return meta.row + meta.settings._iDisplayStart + 1; } },
                    { data: 'TGL_TRANS', className: 'text-center', width: '12%', render: function (d) { return moment(d).format("DD/MM/YYYY - HH:mm") } },
                    { data: 'NO_DOK', className: 'text-center', width: '12%' },
                    { data: 'KET_TRANS', className: 'text-left' },
                    { data: 'DEBET', className: 'text-right', width: '12%', render: $.fn.dataTable.render.number('.', ',', 2) },
                    { data: 'KREDIT', className: 'text-right', width: '12%', render: $.fn.dataTable.render.number('.', ',', 2) },
                    { data: 'SALDO_AKHIR', className: 'text-right text-bold', width: '15%', render: $.fn.dataTable.render.number('.', ',', 2) }
                ],
                autoWidth: false,
                //responsive: true,
                oLanguage: { sSearch: 'Cari:' },
                drawCallback: function (settings) {
                    //if (!$('#dtRekeningKoran').parent().hasClass("table-responsive")) {
                    //    $('#dtRekeningKoran').wrap("<div class='table-responsive'></div>");
                    //}

                    $('#dtRekeningKoran').wrap("<div class='table-responsive'></div>");
                }
            });
        };
        
        $('#bSearch').click(function () {
            GetRekeningKoran();
        });
        
        function ReloadDaftar() {
            $('#dtTabungan').DataTable().ajax.reload(null, false);
            $('#dtGiro').DataTable().ajax.reload(null, false);
            $('#dtDeposito').DataTable().ajax.reload(null, false);
            $('#dtPinjaman').DataTable().ajax.reload(null, false);
        }
    </script>
}